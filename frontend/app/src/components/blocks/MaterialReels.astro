---
import { i18n } from '@helpers/i18n'
const { t } = i18n(Astro.url)

import type { BaseIndustryOrder } from '@dtypes/api.minmatar.org'

interface Props {
    materials_required:     BaseIndustryOrder[];
    init_tooltips:          boolean;
}

const {
    materials_required,
    init_tooltips,
} = Astro.props

let copy_materials = ''
materials_required.map(material => {
    copy_materials = copy_materials.concat(`${material.name}\t${material.quantity}\r\n`)
})

import { number_thousand_separator } from '@helpers/numbers'

import Wrapper from '@components/compositions/Wrapper.astro';
import FlexInline from '@components/compositions/FlexInline.astro';
import FluidFixed from '@components/compositions/FluidFixed.astro';
import FixedFluid from '@components/compositions/FixedFluid.astro';

import MarqueeSwiper from '@components/blocks/MarqueeSwiper.astro';
import ItemPicture from '@components/blocks/ItemPicture.astro';
import ClipboardButton from '@components/blocks/ClipboardButton.astro';
---

<div class="[ bottom-bar ][ card component light-transparency hidden! lg:block! animate-slide-in-bottom ]">
    <Wrapper
        class="[ materials-reel ]"
        neocom={true}
        max_width='var(--max-content-width)'
        centered={true}
        padding_block='var(--space-2xs)'
    >
        <FixedFluid width='170px' class="[ items-center! ]" gap='var(--space-xl)'>
            <h4>{t('material_requirements')}</h4>
            <div>
                <FluidFixed width='165px' class="[ items-center! ]">
                    <div class="[ relative ]">
                        <div
                            class="[ swiper ][ w-full ]"
                            id="materials-list"
                        >
                            <MarqueeSwiper swiper_selector='#materials-list' pagination={false} gap={20}>
                                <div class="[ swiper-slide ]" style="margin-right: 20px; width: 100px"></div>
                                <div class="[ swiper-slide ]" style="margin-right: 20px; width: 100px"></div>
                                <div class="[ swiper-slide ]" style="margin-right: 20px; width: 100px"></div>
                                {materials_required.map(material =>
                                    <div class="[ swiper-slide ]" style="margin-right: 20px">
                                        <FlexInline
                                            class="[ items-center! ]"
                                            gap='var(--space-3xs)'
                                            data-tippy-content={material.name}
                                            x-init={init_tooltips ? 'tippy($el, tippy_options)' : undefined}
                                        >
                                            <ItemPicture
                                                item_name={material.name}
                                                item_id={material.type_id}
                                                size={32}
                                            />
                                            <small>{number_thousand_separator(material.quantity)}</small>
                                        </FlexInline>
                                    </div>
                                )}
                            </MarqueeSwiper>
                        </div>

                        <div id="materials-list-button-prev" class="[ swiper-button-prev ]"></div>
                        <div id="materials-list-button-next" class="[ swiper-button-next ]"></div>
                    </div>

                    <FlexInline justification='flex-end'>
                        <ClipboardButton id="materials">{copy_materials}</ClipboardButton>
                    </FlexInline>
                </FluidFixed>
            </div>
        </FixedFluid>
    </Wrapper>
</div>

<style lang="scss">
    .bottom-bar {
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        z-index: var(--sticky-z-index);
    }

    .materials-reel {
        position: relative;
    }

    .swiper-button-prev,
    .swiper-button-next {
        --swiper-navigation-color: var(--highlight);
        --swiper-navigation-sides-offset: -32px;
        --swiper-navigation-size: 22px;

        opacity: 0;
    }

    .swiper-initialized ~ .swiper-button-prev,
    .swiper-initialized ~ .swiper-button-next {
        opacity: 1;
    }

    .swiper-initialized ~ .swiper-button-next.swiper-button-disabled,
    .swiper-initialized ~ .swiper-button-prev.swiper-button-disabled {
        opacity: 0;
    }

    .swiper-button-next.swiper-button-disabled,
    .swiper-button-prev.swiper-button-disabled {
        --swiper-navigation-color: var(--fleet-yellow);
        opacity: 1;
    }

    .swiper-slide {
        width: fit-content;
    }
</style>