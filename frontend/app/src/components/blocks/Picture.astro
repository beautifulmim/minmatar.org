---
import type { ImageSize } from '@dtypes/layout_components'
import type { ComponentProps } from "astro/types";
type AstroImageOptions = ComponentProps<typeof Image>;

import { Image } from 'astro:assets';

interface Props {
    src:            string;
    alt?:           string;
    size?:          ImageSize;
    narrow?:        boolean;
    mask?:          boolean;
    zoomable?:      boolean;
    placeholder?:   string;
    astro_image?:   AstroImageOptions;
}

const {
    src,
    alt,
    size = 64,
    narrow = false,
    mask = false,
    zoomable = false,
    placeholder,
    astro_image,
} = Astro.props

import ZoomableImage from "@components/blocks/ZoomableImage.astro";
---

<picture class="animated">
    {zoomable ?
        <ZoomableImage
            class:list={[{ mask }, 'h-auto']}
            src={src}
            alt={alt ? alt : undefined}
            loading="lazy"
            astro_image={astro_image ? astro_image : undefined}
        /> :
        <img
            class:list={{ mask }}
            loading="lazy"
            height={narrow ? 412 : size}
            width={size}
            src={src}
            alt={alt ? alt : undefined}
            onerror={placeholder ? `
                this.onerror=null;
                this.src='${placeholder}';
                this.height = ${size}
                this.width = ${size}
            ` : undefined}
        />
    }
</picture>

<style lang="scss">
    img {
        object-fit: cover;
        width: 100%;
    }

    .mask:not(.medium-zoom-image--opened) {
        -webkit-mask-image: linear-gradient(to bottom,rgb(0,0,0) 0%,rgba(0,0,0,.9) 35%,rgba(0,0,0,.7) 50%,transparent 100%);
        mask-image: linear-gradient(to bottom,rgb(0,0,0) 0%,rgba(0,0,0,.9) 35%,rgba(0,0,0,.7) 50%,transparent 100%);
    }
</style>